<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="СНТ Астра">
    <title>СНТ Астра</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<body>

<div class="col-lg-8 mx-auto p-3 py-md-5">
    <div class="overflow-hidden" style="max-height: 30vh;">
        <div class="container px-5 text-center">
            <img src="/files/logo.png" class="img-fluid mb-4" height="100"
                 loading="lazy">
        </div>
    </div>

    <main>
        <h2 class="display-6 text-center mb-4">Информация</h2>

        <div class="table-responsive">
            <table class="table text-center">
                <tbody>
                <tr>
                    <th scope="row" class="text-start">Телефон</th>
                    <td><a href="tel:+79993336731">+7 (999) 333-67-31</a></td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">Адрес</th>
                    <td>142143, МО, ПОДОЛЬСК ГОРОД, БОРИСОВКА ДЕРЕВНЯ</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">ОГРН</th>
                    <td>1025007516820</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">ИНН</th>
                    <td>5074022777</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">КПП</th>
                    <td>507401001</td>
                </tr>
                </tbody>
            </table>
        </div>

        <button class="btn btn-primary btn-lg px-4" data-bs-toggle="modal" data-bs-target="#navigator">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                 class="bi bi-sign-turn-right-fill" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                      d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435ZM9 8.466V7H7.5A1.5 1.5 0 0 0 6 8.5V11H5V8.5A2.5 2.5 0 0 1 7.5 6H9V4.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L9.41 8.658A.25.25 0 0 1 9 8.466Z"></path>
            </svg>
            Навигация
        </button>

        <div class="modal fade" id="navigator" tabindex="-1"
             style="display: none;" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen-sm-down">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Навигация</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h2 class="fs-5 mb-3">Ворота</h2>
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Название</th>
                                <th>Номер</th>
                                <th>Ссылка</th>
                            </tr>
                            </thead>
                            <tbody id="gates-tbody"></tbody>
                        </table>
                        <h2 class="fs-5 mb-3">Участки</h2>
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Улица</th>
                                <th>Номер</th>
                                <th>Ссылка</th>
                            </tr>
                            </thead>
                            <tbody id="lands-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <script>
                async function fetchGraphQL(operationsDoc, operationName, variables) {
                    const result = await fetch(
                        "/v1/graphql",
                        {
                            method: "POST",
                            body: JSON.stringify({
                                query: operationsDoc,
                                variables: variables,
                                operationName: operationName,
                            }),
                        },
                    );

                    return await result.json();
                }

                const operationsDoc = `
                    query lands {
                      gate(where: {coordinates: {_is_null: false}}, order_by: {number: asc}) {
                        name
                        number
                        coordinates
                      }
                      land(where: {coordinates: {_is_null: false}}, order_by: {number_integer: asc}) {
                        id
                        number
                        street {
                          name
                        }
                        coordinates
                      }
                    }
                `;

                function fetchLands() {
                    return fetchGraphQL(
                        operationsDoc,
                        "lands",
                        {},
                    );
                }

                async function startFetchLands() {
                    const {errors, data} = await fetchLands();

                    if (errors) {
                        console.error(errors);
                    }

                    let append = function (elem, coordinates, col1, col2) {
                        let coords = encodeURIComponent(coordinates.replace('(', '').replace(')', '').split(',').reverse().join(','))

                        elem.innerHTML = elem.innerHTML + `
                            <tr>
                                <td class="align-middle">${col1}</td>
                                <td class="align-middle">${col2}</td>
                                <td class="align-middle">
                                    <a href="https://yandex.ru/maps/213/moscow/?ll=${coords}&whatshere[point]=${coords}&z=18" class="btn btn-link btn-small" target="_blank">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>
                                    </a>
                                </td>
                           </tr>`
                    };

                    data.gate.forEach((gate) => append(document.querySelector('#gates-tbody'), gate.coordinates, gate.name, gate.number))
                    data.land.forEach((land) => append(document.querySelector('#lands-tbody'), land.coordinates, land.street.name, land.number))
                }

                startFetchLands();
            </script>
        </div>

        <hr class="col-3 col-md-2 mb-5">

        <h2 class="display-6 text-center mb-4">Банковские реквизиты</h2>

        <div class="table-responsive">
            <table class="table text-center">
                <tbody>
                <tr>
                    <th scope="row" class="text-start">Наименование</th>
                    <td>СНТ "АСТРА"</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">Р/C</th>
                    <td>40703810438000016950</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">БИК</th>
                    <td>044525225</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">Банк</th>
                    <td>ПАО СБЕРБАНК</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">К/C</th>
                    <td>30101810400000000225</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">ИНН</th>
                    <td>5074022777</td>
                </tr>
                <tr>
                    <th scope="row" class="text-start">КПП</th>
                    <td>507401001</td>
                </tr>
                </tbody>
            </table>
        </div>

        <button class="btn btn-primary btn-lg px-4" data-bs-toggle="modal" data-bs-target="#qrSberModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-qr-code"
                 viewBox="0 0 16 16">
                <path d="M2 2h2v2H2V2Z"></path>
                <path d="M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"></path>
                <path d="M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"></path>
                <path d="M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"></path>
                <path d="M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"></path>
            </svg>
            QR Код
        </button>

        <div class="modal fade" id="qrSberModal" tabindex="-1"
             style="display: none;" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen-sm-down">
                <img src="/files/qr_sber.png" class="img-fluid border rounded-3 shadow-lg mb-4"
                     loading="lazy">

            </div>
        </div>
    </main>

    <footer class="pt-5 my-5 text-muted border-top">
        СНТ Астра &middot; &copy; 2022
    </footer>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>

</body>
</html>
